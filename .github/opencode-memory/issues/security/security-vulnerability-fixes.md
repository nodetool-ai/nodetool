### Security Vulnerability Fixes (2026-01-12)

**Vulnerabilities Fixed**:
- DOMPurify XSS (CVE-2024-XXXX) - Updated from 3.2.3 to 3.2.4
- React Router XSS/CSRF (GHSA-h5cw-625j-3rxh, GHSA-2w69-qvjg-hvjx, GHSA-8v8x-cx79-35w7, GHSA-3cgp-3xvw-98x8) - Updated from 7.6.0 to 7.12.0
- React Syntax Highlighter XSS (GHSA-x7hr-w5r2-h6wg) - Updated from 15.6.1 to 16.1.0
- Express/Qs DoS (GHSA-6rw7-vpxm-498p) - Added overrides in electron/package.json
- Missing Content Security Policy - Added CSP meta tag to web/index.html

**Severity**: Critical/High

**Impact**: User data and API keys could be compromised through XSS attacks in workflow names, chat messages, and rendered content. DoS attacks possible through malicious query parameters.

**Solution**:
- Updated direct dependencies to patched versions
- Added npm overrides for transitive dependencies in electron package
- Implemented Content Security Policy to mitigate XSS attacks

**Files Modified**:
- `web/package.json` - Updated dompurify, react-router-dom, react-syntax-highlighter
- `electron/package.json` - Added overrides for qs, express, body-parser
- `web/index.html` - Added CSP meta tag

**Verification**:
- `make typecheck` - PASS
- `make lint` - PASS
- `npm audit web` - Reduced from 8 vulnerabilities (2 high) to 2 (1 high, 1 low)
- `npm audit electron` - Reduced from 12 vulnerabilities (3 high) to 0

**Note**: Remaining 2 web vulnerabilities are in transitive dependencies (glob via esbuild-style-plugin, @eslint/plugin-kit via eslint) that require upstream fixes.

**Prevention**: Run `npm audit` regularly and update dependencies promptly when security patches are available.

---

### Security Audit (2026-01-16)

**Vulnerabilities Fixed**:
- glob Command Injection (GHSA-5j98-mcp5-4vw2) - Added override in web/package.json

**Severity**: High

**Impact**: Remote code execution through glob CLI when using esbuild-style-plugin with shell:true option. This affects the build process but not production runtime.

**Solution**:
- Added npm override `"glob": ">=10.5.0"` in web/package.json
- This forces the transitive dependency to use a patched version

**Files Modified**:
- `web/package.json` - Added glob override

**Verification**:
- `npm audit web --production` - Reduced from 1 high vulnerability to 0
- All packages (web, electron, mobile) now show 0 production vulnerabilities

**Code Security Review**:
- **XSS Prevention**: Workflow names use `escapeHtml()` (via `sanitizeText`) before rendering with `dangerouslySetInnerHTML`
- **CSP**: Meta tag configured with reasonable restrictions (allows inline scripts for development, external fonts)
- **Electron Security**: All BrowserWindows have `nodeIntegration: false`, `contextIsolation: true`, `webSecurity: true`
- **Secrets Handling**: API keys managed through Supabase, stored via backend API (not in localStorage)
- **localStorage Usage**: Only UI state (workflow IDs, panel sizes, editor modes) - no sensitive data
- **TypeScript**: Strict mode enabled in tsconfig.json

**Best Practices Verified**:
- No hardcoded API keys or passwords in source code
- No use of `eval()` or `new Function()`
- No direct DOM manipulation with unsanitized innerHTML
- Proper error handling with type-safe catch blocks

**Prevention**: Continue running `npm audit` regularly and add overrides for transitive dependency vulnerabilities when fixes are available.

---

### Security Audit Status (2026-01-16 - Final Status)

**Production Vulnerability Summary**:

**Web Package**: ✅ 0 vulnerabilities
- Fixed: glob command injection (GHSA-5j98-mcp5-4vw2) via npm override

**Electron Package**: ⚠️ 9 vulnerabilities (5 low, 4 moderate)
- @eslint/plugin-kit ReDoS (low) - via eslint (dev)
- aws-sdk validation (low) - via fuse (prod)
- esbuild development server (moderate) - via fuse/stellate/vite (dev)
- All are development-time issues, not production runtime risks

**Mobile Package**: ⚠️ 9 vulnerabilities (1 high, 7 moderate, 1 low)
- prismjs XSS/ReDoS (high) - via react-native-syntax-highlighter, NO FIX AVAILABLE
- highlight.js ReDoS/Prototype Pollution (moderate) - via react-native-syntax-highlighter
- markdown-it DoS (moderate) - via react-native-markdown-display, NO FIX AVAILABLE
- undici DoS (low) - fix available via `npm audit fix`

**Note on Mobile Vulnerabilities**:
The react-native-syntax-highlighter package has no updates available for its vulnerable prismjs dependency. This is a known issue with React Native ecosystem packages that haven't been updated to use the latest prismjs version. Consider using alternative syntax highlighting libraries if this is a concern.

**Recommended Actions**:
1. Web package: ✅ Fully secured
2. Electron package: Add overrides if needed, but current vulnerabilities are low risk
3. Mobile package: Monitor for updates to react-native-syntax-highlighter, consider alternative

**Ongoing Monitoring**:
- Run `npm audit --omit=dev` to check production vulnerabilities
- Run `npm audit` to see all (including dev) vulnerabilities
- Review @eslint/plugin-kit and esbuild updates periodically
