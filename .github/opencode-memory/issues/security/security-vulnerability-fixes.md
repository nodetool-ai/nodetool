### Security Vulnerability Fixes (2026-01-18)

**Vulnerabilities Fixed**:
- glob CLI Command Injection (GHSA-5j98-mcp5-4vw2) - Added override for glob>=10.5.0 in web/package.json
- tar Arbitrary File Overwrite (GHSA-8qq5-rm4j-mr97) - Updated tar to ^7.5.3 in electron/package.json, added override in mobile/package.json
- XSS in Workflow Name Rendering - Updated WorkflowTile.tsx and OpenOrCreateDialog.tsx to use DOMPurify with ALLOWED_TAGS
- Overly Permissive CSP - Restricted connect-src to only allow self, localhost, and Supabase domains
- Wildcard CORS Headers - Changed to use requesting origin instead of wildcard for better security

**Severity**: High/Medium

**Impact**:
- glob vulnerability could allow command injection through malicious file patterns
- tar vulnerability could allow arbitrary file overwrite during Electron builds
- XSS vulnerabilities in workflow name rendering could compromise user sessions
- Overly broad CSP and CORS policies could enable data exfiltration

**Solution**:
- Added npm overrides for transitive dependency vulnerabilities
- Implemented DOMPurify sanitization for all dangerouslySetInnerHTML usage
- Hardened CSP to restrict network access to necessary endpoints only
- Replaced wildcard CORS headers with dynamic origin validation

**Files Modified**:
- `web/package.json` - Added glob override
- `web/index.html` - Hardened CSP policy
- `web/src/components/workflows/WorkflowTile.tsx` - Added DOMPurify sanitization
- `web/src/components/dialogs/OpenOrCreateDialog.tsx` - Added DOMPurify sanitization
- `electron/package.json` - Updated tar dependency, added CORS origin validation
- `electron/src/window.ts` - Changed wildcard CORS to dynamic origin
- `mobile/package.json` - Added tar override

**Verification**:
- `npm audit web` - 0 vulnerabilities
- `npm audit electron` - 0 vulnerabilities
- `npm audit mobile` - 2 high severity remaining (prismjs via react-native-syntax-highlighter - requires upstream fix)

**Known Limitations**:
- glob vulnerability in esbuild-style-plugin nested dependency cannot be fully patched via npm overrides
- tar vulnerability in electron-builder nested dependencies cannot be fully patched via npm overrides
- prismjs vulnerability in react-native-syntax-highlighter (mobile) requires upstream fix

**Prevention**: Run `npm audit` regularly, use Dependabot for automatic updates, and review transitive dependency vulnerabilities.

---

### Security Vulnerability Fixes (2026-01-12)

**Vulnerabilities Fixed**:
- DOMPurify XSS (CVE-2024-XXXX) - Updated from 3.2.3 to 3.2.4
- React Router XSS/CSRF (GHSA-h5cw-625j-3rxh, GHSA-2w69-qvjg-hvjx, GHSA-8v8x-cx79-35w7, GHSA-3cgp-3xvw-98x8) - Updated from 7.6.0 to 7.12.0
- React Syntax Highlighter XSS (GHSA-x7hr-w5r2-h6wg) - Updated from 15.6.1 to 16.1.0
- Express/Qs DoS (GHSA-6rw7-vpxm-498p) - Added overrides in electron/package.json
- Missing Content Security Policy - Added CSP meta tag to web/index.html

**Severity**: Critical/High

**Impact**: User data and API keys could be compromised through XSS attacks in workflow names, chat messages, and rendered content. DoS attacks possible through malicious query parameters.

**Solution**:
- Updated direct dependencies to patched versions
- Added npm overrides for transitive dependencies in electron package
- Implemented Content Security Policy to mitigate XSS attacks

**Files Modified**:
- `web/package.json` - Updated dompurify, react-router-dom, react-syntax-highlighter
- `electron/package.json` - Added overrides for qs, express, body-parser
- `web/index.html` - Added CSP meta tag

**Verification**:
- `make typecheck` - PASS
- `make lint` - PASS
- `npm audit web` - Reduced from 8 vulnerabilities (2 high) to 2 (1 high, 1 low)
- `npm audit electron` - Reduced from 12 vulnerabilities (3 high) to 0

**Note**: Remaining 2 web vulnerabilities are in transitive dependencies (glob via esbuild-style-plugin, @eslint/plugin-kit via eslint) that require upstream fixes.

**Prevention**: Run `npm audit` regularly and update dependencies promptly when security patches available.
