### Security Vulnerability Fixes (2026-01-12)

**Vulnerabilities Fixed**:
- DOMPurify XSS (CVE-2024-XXXX) - Updated from 3.2.3 to 3.2.4
- React Router XSS/CSRF (GHSA-h5cw-625j-3rxh, GHSA-2w69-qvjg-hvjx, GHSA-8v8x-cx79-35w7, GHSA-3cgp-3xvw-98x8) - Updated from 7.6.0 to 7.12.0
- React Syntax Highlighter XSS (GHSA-x7hr-w5r2-h6wg) - Updated from 15.6.1 to 16.1.0
- Express/Qs DoS (GHSA-6rw7-vpxm-498p) - Added overrides in electron/package.json
- Missing Content Security Policy - Added CSP meta tag to web/index.html

**Severity**: Critical/High

**Impact**: User data and API keys could be compromised through XSS attacks in workflow names, chat messages, and rendered content. DoS attacks possible through malicious query parameters.

**Solution**:
- Updated direct dependencies to patched versions
- Added npm overrides for transitive dependencies in electron package
- Implemented Content Security Policy to mitigate XSS attacks

**Files Modified**:
- `web/package.json` - Updated dompurify, react-router-dom, react-syntax-highlighter
- `electron/package.json` - Added overrides for qs, express, body-parser
- `web/index.html` - Added CSP meta tag

**Verification**:
- `make typecheck` - PASS
- `make lint` - PASS
- `npm audit web` - Reduced from 8 vulnerabilities (2 high) to 2 (1 high, 1 low)
- `npm audit electron` - Reduced from 12 vulnerabilities (3 high) to 0

**Note**: Remaining 2 web vulnerabilities are in transitive dependencies (glob via esbuild-style-plugin, @eslint/plugin-kit via eslint) that require upstream fixes.

**Prevention**: Run `npm audit` regularly and update dependencies promptly when security patches are available.

---

### Security Vulnerability Fixes (2026-01-18) - Web Package Now Vulnerability-Free

**Vulnerabilities Fixed**:
- glob Command Injection (GHSA-5j98-mcp5-4vw2) - Added override for glob >=10.5.0 in web/package.json

**Severity**: High

**Impact**: Command injection via -c/--cmd flag in glob CLI could allow attackers to execute arbitrary commands through malicious file patterns.

**Solution**:
- Added npm override for glob >=10.5.0 in web/package.json
- This forces esbuild-style-plugin's transitive dependency to use a patched version

**Files Modified**:
- `web/package.json` - Added `"glob": ">=10.5.0"` to overrides section

**Verification**:
- `npm audit web` - Now shows **0 vulnerabilities** (previously had 1 high, 9 low)
- All quality checks pass

**Remaining Vulnerabilities (Electron)**:
- 6 HIGH: tar via electron-builder (requires electron-builder 23.0.6 - major downgrade)
- 4 MODERATE: esbuild, fuse, stellate, vite
- 13 LOW: Various transitive dependencies

**Note**: Electron high vulnerabilities come from electron-builder 26.3.4's internal dependencies. Fixing requires either:
1. Downgrading electron-builder to 23.0.6 (breaking change)
2. Waiting for upstream fix from electron-builder
3. Using npm overrides with force flag (may break build)

**Mobile Vulnerabilities**:
- 2 HIGH: tar, prismjs (no fix available for prismjs)
- 7 MODERATE: highlight.js, markdown-it, etc. (no fixes available)
- 1 LOW: undici

---

### Code Security Audit Findings (2026-01-18)

**XSS Mitigation Verified**:
- WorkflowTile.tsx and OpenOrCreateDialog.tsx use `sanitizeText()`/`escapeHtml()` before `dangerouslySetInnerHTML`
- All user-controlled workflow names are properly escaped
- `sanitizeText()` escapes: < > " ' &

**Electron Security Configuration Verified**:
- contextIsolation: true ✓
- nodeIntegration: false ✓
- webSecurity: true ✓

**Content Security Policy Verified**:
- CSP meta tag properly configured in web/index.html
- Restricts scripts, styles, images, connections, media

**No Hardcoded Secrets Found**:
- API keys stored in environment variables
- Uses Supabase auth pattern with proper headers
- No passwords or tokens in source code

**No Dangerous Patterns Found**:
- No eval() or new Function() usage
- No dynamic code execution vulnerabilities
- No insecure deserialization
