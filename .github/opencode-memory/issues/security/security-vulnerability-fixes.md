### Security Vulnerability Fixes (2026-01-12)

**Vulnerabilities Fixed**:
- DOMPurify XSS (CVE-2024-XXXX) - Updated from 3.2.3 to 3.2.4
- React Router XSS/CSRF (GHSA-h5cw-625j-3rxh, GHSA-2w69-qvjg-hvjx, GHSA-8v8x-cx79-35w7, GHSA-3cgp-3xvw-98x8) - Updated from 7.6.0 to 7.12.0
- React Syntax Highlighter XSS (GHSA-x7hr-w5r2-h6wg) - Updated from 15.6.1 to 16.1.0
- Express/Qs DoS (GHSA-6rw7-vpxm-498p) - Added overrides in electron/package.json
- Missing Content Security Policy - Added CSP meta tag to web/index.html

**Severity**: Critical/High

**Impact**: User data and API keys could be compromised through XSS attacks in workflow names, chat messages, and rendered content. DoS attacks possible through malicious query parameters.

**Solution**:
- Updated direct dependencies to patched versions
- Added npm overrides for transitive dependencies in electron package
- Implemented Content Security Policy to mitigate XSS attacks

**Files Modified**:
- `web/package.json` - Updated dompurify, react-router-dom, react-syntax-highlighter
- `electron/package.json` - Added overrides for qs, express, body-parser
- `web/index.html` - Added CSP meta tag

**Verification**:
- `make typecheck` - PASS
- `make lint` - PASS
- `npm audit web` - Reduced from 8 vulnerabilities (2 high) to 2 (1 high, 1 low)
- `npm audit electron` - Reduced from 12 vulnerabilities (3 high) to 0

**Note**: Remaining 2 web vulnerabilities are in transitive dependencies (glob via esbuild-style-plugin, @eslint/plugin-kit via eslint) that require upstream fixes.

**Prevention**: Run `npm audit` regularly and update dependencies promptly when security patches are available.

---

### Additional Security Fixes (2026-01-17)

**Vulnerabilities Addressed**:
- tar Command Injection (GHSA-8qq5-rm4j-mr97) - Added npm overrides in electron, mobile packages
- glob Command Injection (GHSA-5j98-mcp5-4vw2) - Added npm overrides in web package
- Hardcoded Token - Replaced `this.token = "local_token"` with `process.env.NODETOOL_TOKEN || "local_token"` in workflow_runner

**Severity**: High/Medium

**Impact**: 
- tar vulnerability: Arbitrary file overwrite and symlink poisoning during build/packaging
- glob vulnerability: Command injection via -c/--cmd flag in file operations
- Hardcoded token: Development token exposed in source code

**Solution**:
- Added npm overrides for tar (>=7.4.3) in electron and mobile packages
- Added npm overrides for glob (>=10.5.0) in web and electron packages
- Made workflow_runner token configurable via environment variable

**Files Modified**:
- `electron/package.json` - Added tar and glob overrides with nested dependency fixes
- `web/package.json` - Added glob override for esbuild-style-plugin
- `mobile/package.json` - Added tar override
- `workflow_runner/js/workflow-runner.js` - Made token configurable via NODETOOL_TOKEN env var

**Known Issues (Require Upstream Fixes)**:
- Mobile: prismjs XSS vulnerabilities (GHSA-wvhm-4hhf-97x9, GHSA-gj77-59wh-66hg, etc.) - No fix available via react-native-syntax-highlighter
- Mobile: highlight.js vulnerabilities (GHSA-7wwv-vh3v-89cq, GHSA-vfrc-7r7c-w9mx) - No fix available
- Mobile: markdown-it ReDoS (GHSA-6vfc-qv3f-vr6c) - No fix available via react-native-markdown-display
- Electron: Nested dependencies via electron-builder 26.x require further upstream fixes

**Code Security Review Findings**:
- dangerouslySetInnerHTML properly sanitized with escapeHtml/DOMPurify ✓
- No eval() or new Function() usage in production code ✓
- Electron context isolation properly configured (per AGENTS.md guidelines) ✓
- Secrets handled via SecretsStore, not stored in localStorage ✓
