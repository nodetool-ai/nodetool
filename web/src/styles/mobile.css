/* Unified Mobile Styles */
/* Applied when .mobile class is present on body or root container */

@media (max-width: 599.95px) {
  /* Node Menu (Editor) – hide namespace tree and NodeInfo panel for a cleaner mobile menu */
  .mobile .floating-node-menu .namespace-panel-container,
  .mobile .floating-node-menu .node-info-container {
    display: none !important;
  }

  /* Hide type filters in mobile node menu */
  .mobile .floating-node-menu .type-filter-container {
    display: none !important;
  }

  /* Make floating node menu full-width on mobile */
  .mobile .floating-node-menu {
    width: 100vw !important;
    min-width: 100vw !important;
    max-width: 100vw !important;
    left: 0 !important;
    right: 0 !important;
    height: 96dvh !important;
    max-height: 96dvh !important;
    border-radius: 12px 12px 0 0 !important;
  }

  /* Ensure the inner container scroll area fills available height */
  .mobile .floating-node-menu .node-menu-container {
    max-height: calc(96dvh - 50px) !important; /* header ~40px + padding */
    overflow: auto !important;
  }

  /* Expand node results to full width when side panels are hidden */
  .mobile .floating-node-menu .node-list {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Static Node Menu (if visible in any mobile layout) */
  .mobile .static-node-menu .namespace-panel-container,
  .mobile .static-node-menu .node-info-container {
    display: none !important;
  }

  /* Hide type filters if present in static menu headers */
  .mobile .static-node-menu .type-filter-container {
    display: none !important;
  }

  .mobile .static-node-menu .node-list {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Make search input full-width in node menu on mobile */
  .mobile .floating-node-menu .search-input-container,
  .mobile .static-node-menu .search-input-container {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Make property inputs full-width inside nodes on mobile */
  .mobile .node-property input[type="text"],
  .mobile .node-property input[type="number"],
  .mobile .node-property textarea,
  .mobile .node-property .MuiInputBase-root,
  .mobile .node-property .MuiSelect-select {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  /* Models Manager (Hugging Face) – hide left panel on mobile */
  /* The left panel is the download/search side: .download-models-section */
  .mobile .models-manager-dialog .download-models-section {
    display: none !important;
  }

  /* Expand existing models section to full width when left is hidden */
  .mobile .models-manager-dialog .existing-models-section {
    width: 100% !important;
  }

  /* Model List view – hide the ModelTypeSidebar (left panel) on mobile */
  .mobile .models-manager-dialog .model-list-container .sidebar,
  .mobile .models-manager-dialog .model-list-container .model-type-list {
    display: none !important;
  }

  /* Ensure the right content expands when sidebar is hidden */
  .mobile .models-manager-dialog .model-list-container .content {
    width: 100% !important;
    padding-left: 0 !important;
  }

  /* Compact model item actions on mobile */
  .mobile .models-manager-dialog .model-list-item .actions-container {
    gap: 0.25em !important;
    min-width: auto !important;
  }
  .mobile .models-manager-dialog .model-list-item .model-actions {
    gap: 0.1em !important;
  }
  .mobile .models-manager-dialog .model-list-item .model-download-button {
    padding: 0.25em 0.5em !important;
    font-size: var(--fontSizeSmall) !important;
  }
  .mobile .models-manager-dialog .model-list-item .model-size {
    min-width: auto !important;
    font-size: var(--fontSizeSmaller) !important;
  }
  /* Hide external links in actions for tighter layout */
  .mobile .models-manager-dialog .model-list-item .model-link {
    display: none !important;
  }

  /* Hide provider chip and file explorer button on mobile */
  .mobile
    .models-manager-dialog
    .model-list-item
    .model-details
    .MuiChip-root:not(.pipeline-tag) {
    display: none !important;
  }
  .mobile .models-manager-dialog .model-list-item .show-in-explorer-button {
    display: none !important;
  }
  /* Model Menu (LanguageModelSelect) Mobile Trims */
  .mobile .model-menu__dialog .MuiDialog-paper {
    width: 98% !important;
    max-width: 100% !important;
    margin: 8px !important;
  }

  /* Collapse complex 3-column grid → single column */
  .mobile .model-menu__grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto 1fr !important;
    gap: 4px !important;
  }

  /* Hide provider list and sidebar (favorites/recent) */
  .mobile .model-menu__providers-list,
  .mobile .model-menu__sidebar {
    display: none !important;
  }

  /* Hide advanced filters bar (keep just search) */
  .mobile .model-menu__filters-bar {
    display: none !important;
  }

  /* Expand model list to full width */
  .mobile .model-menu__model-list-container {
    max-width: none !important;
    width: 100% !important;
  }

  /* Hide footer counts and other non-essential info */
  .mobile .model-menu__footer {
    display: none !important;
  }

  /* Chat Composer Mobile Styles */
  .mobile .compose-message {
    display: flex !important;
    flex-direction: row !important;
    height: 40px !important;
    gap: 4px !important;
    padding: 0 !important;
    align-items: center !important;
    justify-content: space-between !important;
    overflow: hidden !important;
    contain: layout style !important;
  }

  .mobile .compose-message .message-input-container {
    flex: 1 !important;
    min-width: 0 !important;
    height: 40px !important;
    max-height: 40px !important;
  }

  .mobile .compose-message .action-buttons-container {
    flex-shrink: 0 !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
  }

  /* Chat Thread View Mobile Styles */
  .mobile .chat-thread-view-root {
    contain: layout style !important;
  }

  .mobile .scrollable-message-wrapper {
    padding: 8px !important;
    scrollbar-width: thin !important;
  }

  .mobile .scrollable-message-wrapper::-webkit-scrollbar {
    width: 4px !important;
  }

  /* Chat Input Section Mobile Styles */
  .mobile .chat-input-section {
    flex-direction: row !important;
    padding: 12px 12px 8px 12px !important;
  }

  /* Show chat composer action buttons on mobile (send/stop/new) */
  .mobile .chat-action-buttons {
    display: inline-flex !important;
    align-items: center !important;
    gap: 6px !important;
  }

  /* Hide only the New Chat button on mobile */
  .mobile .new-chat-button-wrapper {
    display: none !important;
  }

  /* Ensure composer icon buttons fit the 40px composer height */
  .mobile .compose-message .MuiIconButton-root {
    width: 40px !important;
    height: 40px !important;
    min-width: 40px !important;
    min-height: 40px !important;
    padding: 0 !important;
  }

  .mobile .chat-input-section .chat-controls {
    max-width: auto !important;
    width: auto !important;
  }

  /* .mobile .chat-input-sectioan .chat-composer-wrapper {
    width: auto !important;
    order: 2 !important;
    min-height: 40px !important;
    max-height: 40px !important;
  } */

  .mobile .chat-input-section .chat-composer-wrapper .chat-input {
    padding: 0px 12px;
  }

  /* Global Chat Mobile Styles */
  .mobile .global-chat-container {
    height: 100dvh !important;
    max-height: 100dvh !important;
    padding-top: 40px !important; /* Add padding for header */
    /* Leave space for the left panel/resize handle */
    margin-left: 40px !important;
    max-width: calc(100vw - 60px) !important;
    contain: layout style !important;
  }

  .mobile .app-header .nav-button-text {
    display: none !important;
  }

  /* Remove nav-group box-shadow on mobile */
  .mobile .app-header .nav-group {
    box-shadow: none !important;
  }

  /* Adjust logo spacing on mobile */
  .mobile .app-header .logo-container {
    margin-right: 12px !important;
  }

  /* Keep header fixed at the very top on mobile */
  .mobile .app-header {
    position: fixed !important;
    top: 0 !important;
    z-index: 1400 !important; /* Higher than panels */
  }

  /* Panel Left Mobile Styles */
  .mobile .panel-container {
    z-index: 1050 !important;
  }

  .mobile .panel-container .panel-left {
    top: 0px !important;
    max-height: 100dvh !important;
    contain: layout style !important;
  }

  /* Add padding to panel content to avoid header overlap */
  .mobile .panel-container .panel-left .vertical-toolbar {
    padding-top: 40px !important;
  }

  .mobile .panel-container .panel-button {
    height: 100vh !important;
    top: 0px !important;
    cursor: pointer !important;
  }

  /* .mobile .panel-container .vertical-toolbar .MuiIconButton-root,
  .mobile .panel-container .vertical-toolbar .MuiButton-root {
    min-height: 44px !important;
    min-width: 44px !important;
  } */

  /* Panel Right Mobile Styles - Hide entire right panel container on mobile */
  .mobile .panel-right,
  .mobile .panel-right .panel-container {
    display: none !important;
  }

  /* Node Menu Mobile Styles */
  .mobile .floating-node-menu {
    border: none !important;
    border-radius: 0px !important;
    box-shadow: none !important;
    width: 100vw !important;
    max-width: 100vw !important;
    min-width: 100vw !important;
    left: 0 !important;
    background-color: var(--palette-grey-900) !important;
    max-height: calc(
      100vh - 100px
    ) !important; /* Account for floating toolbar */
    top: 0 !important;
    bottom: 100px !important; /* Leave space for floating toolbar */
  }

  /* Add backdrop overlay for mobile node menu */
  .mobile .floating-node-menu::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: -1;
    pointer-events: none;
  }

  /* Hide node menu header completely on mobile */
  .mobile .floating-node-menu .draggable-header {
    display: none !important;
  }

  /* Node menu search input full width on mobile */
  .mobile .floating-node-menu .search-toolbar {
    width: 100% !important;
    padding: 8px 16px !important;
    display: flex !important;
    flex-direction: column !important;
  }

  .mobile .floating-node-menu .search-toolbar .search-input {
    width: 100% !important;
    max-width: none !important;
  }

  .mobile .floating-node-menu .search-toolbar .MuiTextField-root {
    width: 100% !important;
    max-width: none !important;
  }

  /* Hide welcome content and explanation on mobile */
  .mobile .floating-node-menu .no-selection {
    display: none !important;
  }

  .mobile .floating-node-menu .explanation {
    display: none !important;
  }

  .mobile .floating-node-menu .node-packs-info {
    display: none !important;
  }

  /* General Mobile Layout */
  .mobile {
    touch-action: manipulation !important;
  }

  .mobile * {
    -webkit-tap-highlight-color: transparent !important;
  }

  /* Ensure mobile-optimized touch targets */
  .mobile button,
  .mobile .MuiIconButton-root,
  .mobile .MuiButton-root {
    min-height: 44px !important;
    min-width: 44px !important;
  }

  .mobile .main-container {
    height: 100dvh !important;
    max-height: 100dvh !important;
    overflow: hidden !important;
    contain: layout style !important;
  }

  /* Hide AppToolbar actions (editor) on mobile */
  .mobile .tabs-node-editor .actions-container .actions {
    display: none !important;
  }

  /* Hide top editor tabs on mobile */
  .mobile .tabs-node-editor .tabs-container {
    display: none !important;
  }

  /* Move App Header to the very top and adjust left panel offsets */
  .mobile .panel-container .panel-left {
    top: 40px !important; /* Header only (40px) */
    max-height: calc(100dvh - 40px) !important;
    /* Only expand left panel to full width when visible */
    width: 100vw !important;
    max-width: 100vw !important;
    left: 0 !important;
    /* Prevent pointer events when panel is collapsed */
    pointer-events: auto !important;
  }

  /* When panel is collapsed, ensure it doesn't block touch events */
  .mobile .panel-container:not(.panel-visible) .panel-left {
    pointer-events: none !important;
  }

  /* Keep toolbar visible and interactive when panel is collapsed */
  .mobile .panel-container:not(.panel-visible) .vertical-toolbar {
    pointer-events: auto !important;
  }

  /* Hide panel resize handles/drawer handles on mobile */
  .mobile .panel-resize-button,
  .mobile .panel-container .panel-button {
    display: none !important;
  }

  /* Ensure the panel container itself doesn't constrain width on mobile */
  .mobile .panel-container {
    /* Revert overly broad width that blocked canvas interactions */
    left: auto !important;
    width: auto !important;
  }
}

/* Ensure ReactFlow receives touch gestures on mobile */
@media (max-width: 599.95px) {
  .mobile .reactflow-wrapper,
  .mobile .react-flow {
    touch-action: none !important;
  }
}
