{"version":3,"file":"main.js","sources":["../../src/index.ts"],"sourcesContent":["import { IntervalRef } from \"./types\";\n\nconst logElement = document.getElementById(\"log\")!;\nconst bootMessage = document.getElementById(\"boot-message\")!;\nconst logContainer = document.getElementById(\"log-container\")!;\nconst logToggle = document.getElementById(\"log-toggle\")!;\nconst updateStepsElement = document.getElementById(\"update-steps\")!;\nconst openLogFileButton = document.getElementById(\"open-log-file\")!;\n\nconst strokeInterval: IntervalRef = { current: null };\nconst fillInterval: IntervalRef = { current: null };\nconst colorfulStrokeInterval: IntervalRef = { current: null };\nconst colorfulFillInterval: IntervalRef = { current: null };\n\ninterface SimpleLogger {\n  log: (message: string) => void;\n}\n\nfunction createSimpleLogger(logElement: HTMLElement): SimpleLogger {\n  function log(message: string): void {\n    const logLine = document.createElement(\"p\");\n    logLine.className = \"log-line\";\n    logLine.textContent = message;\n    logElement.appendChild(logLine);\n    logElement.scrollTop = logElement.scrollHeight;\n  }\n\n  return { log };\n}\n\nfunction toggleLog(): void {\n  logContainer.classList.toggle(\"expanded\");\n  const isExpanded = logContainer.classList.contains(\"expanded\");\n  logToggle.innerHTML = isExpanded\n    ? \"<span>▼ Hide Log</span>\"\n    : \"<span>▲ Show Log</span>\";\n}\n\nconst simpleLogger = createSimpleLogger(logElement);\n\nfunction loadContentWithNoCaching(initialURL: string): void {\n  const timestamp = new Date().getTime();\n  window.location.href = `${initialURL}?nocache=${timestamp}`;\n}\n\nfunction updateProgress(\n  componentName: string,\n  progress: number,\n  action: string,\n  eta?: string\n): void {\n  const updateStepsElement = document.getElementById(\"update-steps\");\n  const progressBar = document.querySelector<HTMLElement>(\".progress\");\n  const progressPercentage = document.querySelector<HTMLElement>(\n    \".progress-percentage\"\n  );\n  const progressEta = document.querySelector<HTMLElement>(\".progress-eta\");\n  const actionLabel = document.querySelector<HTMLElement>(\".action-label\");\n\n  if (\n    !updateStepsElement ||\n    !progressBar ||\n    !progressPercentage ||\n    !actionLabel ||\n    !progressEta\n  ) {\n    console.warn(\"Required elements not found\");\n    return;\n  }\n\n  if (progress < 100) {\n    updateStepsElement.style.display = \"block\";\n  }\n\n  progressBar.style.width = `${progress}%`;\n  progressPercentage.textContent = `${Math.round(progress)}%`;\n  actionLabel.textContent = `${action} ${componentName}`;\n\n  progressEta.textContent = eta ? ` (${eta})` : \"\";\n\n  if (progress === 100) {\n    setTimeout(() => {\n      if (updateStepsElement) {\n        updateStepsElement.style.display = \"none\";\n      }\n    }, 5000);\n  }\n}\n\nfunction hideElement(element: HTMLElement | null): void {\n  if (element) {\n    element.style.display = \"none\";\n  }\n}\n\nfunction showElement(\n  element: HTMLElement | null,\n  displayType: string = \"block\"\n): void {\n  if (element) {\n    element.style.display = displayType;\n  }\n}\n\nfunction hideBootMessage(): void {\n  hideElement(bootMessage);\n}\n\nfunction showBootMessage(): void {\n  showElement(bootMessage);\n}\n\nfunction hideUpdateSteps(): void {\n  hideElement(updateStepsElement);\n}\n\nfunction showUpdateSteps(): void {\n  showElement(updateStepsElement);\n}\n\nfunction hideInstallLocationPrompt(): void {\n  hideElement(document.getElementById(\"install-location-prompt\"));\n}\n\nfunction showInstallLocationPrompt(): void {\n  showElement(document.getElementById(\"install-location-prompt\"));\n}\n\nfunction hideUpdateNotification(): void {\n  hideElement(document.getElementById(\"update-notification\"));\n}\n\nfunction showUpdateNotification(): void {\n  showElement(document.getElementById(\"update-notification\"));\n}\n\nfunction hideLogs(): void {\n  logContainer.classList.remove(\"expanded\");\n  logToggle.innerHTML = \"<span>▲ Show Log</span>\";\n}\n\nfunction showLogs(): void {\n  logContainer.classList.add(\"expanded\");\n  logToggle.innerHTML = \"<span>▼ Hide Log</span>\";\n}\n\nfunction initializeApp(): void {\n  window.api\n    .getServerState()\n    .then(({ isStarted, bootMsg, logs, initialURL }) => {\n      console.log(\"Server state:\", { isStarted, bootMsg, logs });\n      if (isStarted) {\n        loadContentWithNoCaching(initialURL);\n        hideBootMessage();\n        hideUpdateSteps();\n        hideLogs();\n        clearAllAnimations();\n      } else {\n        const bootTextElement = document.querySelector(\".boot-text\");\n        if (bootTextElement) {\n          bootTextElement.textContent = bootMsg;\n        }\n        startIconAnimations();\n      }\n\n      logs.forEach((log) => simpleLogger.log(log));\n    });\n}\n\nwindow.api.onUpdateProgress(({ componentName, progress, action, eta }) => {\n  updateProgress(componentName, progress, action, eta);\n});\n\nwindow.api.onServerStarted(() => {\n  initializeApp();\n});\n\nwindow.api.onBootMessage((message) => {\n  const bootTextElement = document.querySelector(\".boot-text\");\n  if (bootTextElement) {\n    bootTextElement.textContent = message;\n  }\n\n  if (message.includes(\"Setting up Python\")) {\n    showLogs();\n  }\n});\n\nwindow.api.onServerLog((message) => {\n  simpleLogger.log(message);\n});\n\nlogToggle.addEventListener(\"click\", toggleLog);\nopenLogFileButton.addEventListener(\"click\", async () => {\n  await window.api.openLogFile();\n});\ninitializeApp();\n\nwindow.api.onUpdateAvailable((info) => {\n  const updateNotification = document.getElementById(\"update-notification\");\n  const releaseLink = document.getElementById(\n    \"release-link\"\n  ) as HTMLAnchorElement | null;\n\n  if (!updateNotification || !releaseLink) {\n    console.warn(\"Update notification elements not found\");\n    return;\n  }\n\n  showUpdateNotification();\n  releaseLink.href = info.releaseUrl;\n  releaseLink.onclick = (e) => {\n    e.preventDefault();\n    window.api.openExternal(info.releaseUrl);\n  };\n});\n\nfunction getRandomGrayColor(): string {\n  const grayValue = Math.floor(Math.random() * 100);\n  return `#${grayValue.toString(16).padStart(2, \"0\").repeat(3)}`;\n}\n\nfunction getRandomColor(): string {\n  const randomColor = Math.floor(Math.random() * 16777215).toString(16);\n  return `#${randomColor.padStart(6, \"0\")}`;\n}\n\nfunction updateStroke(): void {\n  const icon = document.querySelector<HTMLElement>(\".nodetool-icon\");\n  if (!icon) {\n    console.warn(\"Icon element not found or invalid\");\n    return;\n  }\n\n  icon.style.setProperty(\"--stroke-color\", getRandomGrayColor());\n}\n\nfunction updateFill(): void {\n  const icon = document.querySelector<HTMLElement>(\".nodetool-icon\");\n  if (!icon) {\n    console.warn(\"Icon element not found or invalid\");\n    return;\n  }\n\n  icon.style.setProperty(\"--fill-color\", getRandomGrayColor());\n}\n\nfunction clearAllAnimations(): void {\n  [\n    strokeInterval,\n    fillInterval,\n    colorfulStrokeInterval,\n    colorfulFillInterval,\n  ].forEach((interval) => {\n    if (interval.current) {\n      clearInterval(interval.current);\n      interval.current = null;\n    }\n  });\n}\n\nfunction startIconAnimations(): void {\n  updateStroke();\n\n  strokeInterval.current = setInterval(updateStroke, 5000);\n\n  setTimeout(() => {\n    fillInterval.current = setInterval(updateFill, 5000);\n  }, 60000 + 2500);\n\n  setTimeout(() => {\n    colorfulStrokeInterval.current = setInterval(() => {\n      const icon = document.querySelector<HTMLElement>(\".nodetool-icon\");\n      if (!icon) {\n        console.warn(\"Icon element not found or invalid\");\n        return;\n      }\n      icon.style.setProperty(\"--stroke-color\", getRandomColor());\n    }, 5000);\n  }, 5 * 60000);\n\n  setTimeout(() => {\n    colorfulFillInterval.current = setInterval(() => {\n      const icon = document.querySelector<HTMLElement>(\".nodetool-icon\");\n      if (!icon) {\n        console.warn(\"Icon element not found or invalid\");\n        return;\n      }\n      icon.style.setProperty(\"--fill-color\", getRandomColor());\n    }, 5000);\n  }, 10 * 60000 + 2500);\n}\n\nwindow.api.onInstallLocationPrompt(async ({ defaultPath }) => {\n  const defaultLocationPath = document.querySelector(\".location-path\");\n  const sizeInfo = document.querySelector(\".size-info\");\n\n  if (!defaultLocationPath || !sizeInfo) {\n    console.warn(\"Install location prompt elements not found\");\n    return;\n  }\n\n  defaultLocationPath.textContent = defaultPath;\n  hideBootMessage();\n  showInstallLocationPrompt();\n\n  const defaultLocationButton = document.querySelector(\".default-location\");\n  const customLocationButton = document.querySelector(\".custom-location\");\n  const modules = {\n    ai: document.querySelector('input[name=\"ai-package\"]') as HTMLInputElement,\n    dataScience: document.querySelector(\n      'input[name=\"data-science\"]'\n    ) as HTMLInputElement,\n  };\n\n  if (defaultLocationButton && customLocationButton) {\n    defaultLocationButton.addEventListener(\"click\", async () => {\n      const selectedModules = {\n        ai: modules.ai?.checked || false,\n        dataScience: modules.dataScience?.checked || false,\n      };\n      await window.api.selectDefaultInstallLocation(selectedModules);\n      hideInstallLocationPrompt();\n      showBootMessage();\n    });\n\n    customLocationButton.addEventListener(\"click\", async () => {\n      const selectedModules = {\n        ai: modules.ai?.checked || false,\n        dataScience: modules.dataScience?.checked || false,\n      };\n      await window.api.selectCustomInstallLocation(selectedModules);\n      hideInstallLocationPrompt();\n      showBootMessage();\n    });\n  }\n});\n"],"names":["logElement","bootMessage","logContainer","logToggle","updateStepsElement","openLogFileButton","strokeInterval","fillInterval","colorfulStrokeInterval","colorfulFillInterval","createSimpleLogger","log","message","logLine","toggleLog","isExpanded","simpleLogger","loadContentWithNoCaching","initialURL","timestamp","updateProgress","componentName","progress","action","eta","progressBar","progressPercentage","progressEta","actionLabel","hideElement","element","showElement","displayType","hideBootMessage","showBootMessage","hideUpdateSteps","hideInstallLocationPrompt","showInstallLocationPrompt","showUpdateNotification","hideLogs","showLogs","initializeApp","isStarted","bootMsg","logs","clearAllAnimations","bootTextElement","startIconAnimations","info","updateNotification","releaseLink","e","getRandomGrayColor","getRandomColor","updateStroke","icon","updateFill","interval","defaultPath","defaultLocationPath","sizeInfo","defaultLocationButton","customLocationButton","modules","_a","_b","selectedModules"],"mappings":"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"}